# generaltable
Parse JavaScript array data and convert it to HTML table. With search, sort and other features.

資材は
https://github.com/nnnmu24/generaltable
よりDLしてください。


# 機能紹介

## 概要
- 2次元配列で定義したデータを表に変換しブラウザに表示。
- 列のソートが可能。
- 列単位の検索が可能。
- ページングが可能。
- 列、行をチェックしその単位での表示/非表示が可能。
- 列単位でデータの型（文字列、数値、日付）を持ち、数値型、日付型は値の妥当性チェックを実施。
- 表オプション定義を追加し、カラム単位にタグ付与による装飾が可能。
- 表示に関する設定エリアを設け、入力した設定値を保存。

## 画面の説明
表の画像


### メニューエリア
- 「設定」リンク  
　設定エリアの表示/非表示を切り替えます。  
- 「検索」リンク  
　表示変更エリアの表示/非表示を切り替えます。  

### 設定エリア
- 「表データの書式エラーを表示」チェックボックス  
　表データの定義内容に不備があった場合、初回表示時にその内容をダイアログで表示します。  
- 「1ページの表示数」テキスト  
　行の総数が本項目値の表示数を超えている場合、以降を非表示にしページングエリアにページ情報を表示します。  
　以降の行はページングエリアの操作で表示します。  
　本項目を変更時、表を1ページ目に戻し再表示します。  
- 「長文を省略」テキスト  
　長文の表データを本項目値の上限数で切り捨て、以降「...」で表示します。  
　全文はtitle属性に指定し、マウスオーバーでポップアップします。  

### 表示変更エリア
- 「ソート初期化」ボタン  
　現在のソート順をクリアし、最初の状態にします。  
　本項目を変更時、表を1ページ目に戻し再表示します。  
- 「チェック列を表示」チェックボックス  
　列選択チェックボックスをチェックした列の表示/非表示を切り替えます。  
- 「チェック行を表示」チェックボックス  
　行選択チェックボックスをチェックした行の表示/非表示を切り替えます。  
　本項目を変更時、表を1ページ目に戻し再表示します。  
- 「検索」ボタン  
　検索対象の列名を選択、検索語句を入力し、ボタン押下で部分一致した行のみに表示を絞り込みます。  
　半角空白を入れるとAND検索になります。  
　「検索」「数値絞込」「日付絞込」を組み合わせた検索はできません。  
　本項目を変更時、表を1ページ目に戻し再表示します。  
- 「数値絞込」ボタン  
　表データに数値型の列がある場合に表示します。  
　検索対象の列名を選択し、上限値と下限値を入力し、ボタン押下で範囲内の行のみに表示を絞り込みます。  
　上限値または下限値の入力を省略すると上限/下限なしになります。  
　「検索」「数値絞込」「日付絞込」を組み合わせた検索はできません。  
　本項目を変更時、表を1ページ目に戻し再表示します。  
- 「日付絞込」ボタン  
　表データに日付型の列がある場合に表示します。  
　検索対象の列名を選択し、開始日時と終了日時を入力し、ボタン押下で範囲内の行のみに表示を絞り込みます。  
　開始日時または終了日時の入力を省略すると開始日時/終了日時なしになります。  
　実体は文字列検索なので、指定列の日付書式に従って入力してください。  
　「検索」「数値絞込」「日付絞込」を組み合わせた検索はできません。  
　本項目を変更時、表を1ページ目に戻し再表示します。  

### 表エリア
- 列タイトル  
　クリックで該当列の昇順/降順のソートを実施し再表示します。  
　ソートの都度対象列のソートマークが「▲」「▼」に変わります。  
　昇順、降順はクリックの度に切り替わります。  
　「ソート初期化」ボタンでソート順はクリアされます。  
- 列選択チェックボックス  
　各列タイトルの左にあるチェックボックスです。  
　「チェック列を表示」チェックボックスによる非表示対象の列をマークします。  
- 行選択チェックボックス  
　各行の左にあるチェックボックスです。  
　「チェック行を表示」チェックボックスによる非表示対象の行をマークします。  
　チェック行はページをまたいで有効です。  
　本項目を変更時、表を1ページ目に戻し再表示します。  

### ページングエリア
- 前のページを表示  
　「1ページの表示数」テキストの設定によりページが複数存在し、かつ前のページが存在する場合に「＜」が表示されます。  
　これをクリックすると現在より1ページ前を表示します。  
- 次のページを表示  
　「1ページの表示数」テキストの設定によりページが複数存在し、かつ次のページが存在する場合に「＞」が表示されます。  
　これをクリックすると現在より1ページ先を表示します。  


## 設定の保存
- 設定エリア、表示変更エリア、表エリアの入力項目のうち、以下を保存します。  
　保存した項目はブラウザ再起動後の初回表示時にロードし適用されます。  
　設定値は表データに定義する表コード毎に保存します。  
　保存対象は以下の項目です。  
  - 「表データの書式エラーを表示」チェックボックスの設定  
  - 「1ページの表示数」テキストの設定  
  - 「長文を省略」テキストの設定  
  - 「チェック列を表示」チェックボックスの設定  
特別に、本項目が未チェックの場合でも初回表示時はチェックした列を表示します。  
これを非表示にする場合は本項目をチェック→未チェックとしてください。  
  - 「チェック行を表示」チェックボックスの設定  
  - 列選択チェックボックスの設定  
  - 行選択チェックボックスの設定  



# 表データ定義

## 表データの定義
定義するデータは表データと表オプションが存在します。

サンプルの表データは以下の通りです。
```
const tableDataSource = [
["SAMPLE01","映像作品リスト"],
["タイトル","ジャンル","鑑賞方法","鑑賞日","評価"],
["text","text","text","date.YYYY年MM月DD日","num"],
["","option01","","","option02"],
["アメリカのヒーローが大集合","アクション","","",""],
["余命少ない恋人と過ごす","恋愛","テレビ","2017年03月05日","3"],
["銀河を支配する帝国を打倒する","SF","DVD購入","2018年01月15日","5"],
["剣と魔法で闘う勇者","ファンタジー","動画配信サイト","2018年09月16日","1"],
["伝説の龍を育てる","ファンタジー","レンタルDVD","2019年02月05日","3"],
["王子様系の転校生に恋をする","恋愛","テレビ","2019年08月21日","2"],
["ドタバタ家族の海外ドラマ","コメディ","動画配信サイト","2019年05月05日","5"],
["とある王朝の栄枯","歴史","DVD購入","2018年11月03日","5"],
["続・とある王朝の栄枯","歴史","DVD購入","2019年08月21日","4"],
["学校一の不良を決める喧嘩祭","アクション","レンタルDVD","2017年07月11日","3"],
["豪華客船での恋物語","恋愛","映画館","2017年08月01日","5"],
["天下無双の剣豪","アクション","映画館","2020年01月04日","1"],
["伝説の傭兵が立ち上がる","アクション","映画館","2019年12月09日","4"],
["銀河を支配する帝国を打倒する・前日譚","SF","","",""],
["美大生全員が片想い","恋愛","映画館","2017年10月20日","5"],
];
```

サンプルの表オプションは以下の通りです。
```
const tableColumnOption = {
    option01: ["<div style='color:red'>", "</div>"],
    option02: ["★"],
};
```

表データの定義内容を説明します。  
1行目から4行目は表の定義で、5行目以降が表の実データになります。

- 1行目、1要素目：表コード  
　表を識別するコード値を記述します。任意の文字を指定可能です。  
　設定を保存する際のキーに使用します。  
- 1行目、2要素目：表名  
　表の名前を記述します。任意の文字を指定可能です。  
　表のタイトルとして表示します。  
- 2行目：列名  
　各列の名称を記述します。任意の文字を指定可能です。  
　表のヘッダとして表示します。  
- 3行目：列の型  
　各列がどの値であるかを示す型を記述します。文字列、数値、日付のいずれかとします。  
　型名はそれぞれ「text」「num」「date」です。  
　dateは"."を付与し日時書式を追記します（例「date.YYYY/MM/DD」）日時書式は後述のいずれかとしてください。  
　列の型は検索、ソート処理に影響します。  
　配列要素は列名と同数としてください。要素超過分は無視されます。  
　数値型、日付型を1つ以上定義した場合、表示変更エリアに数値絞込、日付絞込が表示されます。  
- 4行目：列オプション  
　特定列の表データを装飾したい場合に、表オプションで定義したオプション名を記述します。装飾しない場合は空文字。  
　オプション名を記述した場合、該当列の表データの前後に表オプションの文字列を付与します。この文字列はHTMLとして解釈されます。  
　配列要素は列名と同数としてください。要素超過分は無視されます。  
　サンプルの場合、2列目にoption1が、5列目にoption2が適用されます。  
　これにより2列目は文字色が赤色に、5列目は先頭に"★"が追加されます。  
- 5行目以降：表データ  
　表データの実値を記述します。  
　行の要素数に上限はありません。  
　値は任意ですが、数値型、日付型を指定した列はその定義に従った値にしてください。空文字は可能です。  
　列の要素数は列名と同数としてください。要素超過分は無視されます。  

## 表の解析、異常ケース
初回表示時に表データの定義値が正当かをチェックし、不備があった場合その内容をダイアログで表示します。  
チェック内容と、不正時のデフォルト値は以下の通りです。  
- 表コード：未定義または空文字→デフォルト値「T0001」  
- 表名：未定義または空文字→デフォルト値「デフォルト表」  
- カラム名：空文字→デフォルト値「カラム1」「カラム2」・・・  
- カラム型  
　カラム型不正→デフォルト値「text」  
　日付書式不正→デフォルト値「text」  
- カラムオプション：不正なキー→デフォルト値 オプションなし  
- 表レコード  
　カラム数に足りない→デフォルト値 空文字  
　数値型、日付型で不正→デフォルト値 空文字  

## 列の型「日付型」の日時書式について
列の型に日付型を指定した場合、型名「date」の後に"."を付与し日時書式を追記します。  
日時書式は以下に示す「日付要素」「時刻要素」または「日付要素 時刻要素」のいずれかとしてください。  

例．
- date.YYYY/MM/DD
- date.HH:mm:ss
- date.YYYY年MM月DD日 HH時mm分ss秒
"."以降を省略した場合はデフォルトで「YYYY/MM/DD HH:mm:ss」が適用されます。

- 日付要素
  - YYYYMMDD
  - YYYY/MM/DD
  - YYYY-MM-DD
  - YYYY年MM月DD日
  - MMDD
  - MM/DD
  - MM-DD
  - MM月DD日
- 時刻要素
  - HHmmss
  - HH:mm:ss
  - HH時mm分ss秒
  - HHmm
  - HH:mm
  - HH時mm分



# 表のカスタマイズ

メニューエリア、設定エリア、表示変更エリア、ページングエリアのタグはtable.html内に直接記述しています。
表エリアは動的に生成します。タグ構成は以下のようになります。

```
<table>
  <thead class="tableHead">
    <tr>
      <th>-</th>
      <th>
        <iniput type="checkbox" class="tableHeadCheck" id="table_cl_000">
        <span class"tableColumnSortMarker">-<span>
        <div class="tableColumn">xxxxxxxx</div>
      </th>
      <th>
        <iniput type="checkbox" class="tableHeadCheck" id="table_cl_001">
        <span class"tableColumnSortMarker">-<span>
        <div class="tableColumn">xxxxxxxx</div>
      </th>
        :
        :
        :
    </tr>
  </thead>
  <tbody class="tableBody">
    <tr id="rc_000001">
      <td><iniput type="checkbox" class="tableBodyCheck" id="table_rc_000001"></td>
      <td class="tableValue" id="rc_000001_0">xxxxxxxx</td>
      <td class="tableValue" id="rc_000001_1">xxxxxxxx</td>
      <td class="tableValue" id="rc_000001_2">xxxxxxxx</td>
        :
        :
        :
    </tr>
    <tr id="rc_000002">
      <td><iniput type="checkbox" class="tableBodyCheck" id="table_rc_000002"></td>
      <td class="tableValue" id="rc_000002_0">xxxxxxxx</td>
      <td class="tableValue" id="rc_000002_1">xxxxxxxx</td>
      <td class="tableValue" id="rc_000002_2">xxxxxxxx</td>
        :
        :
        :
    </tr>
      :
      :
      :
  </tbody>
<table>
```

デザインはstyle.cssに定義しているので、変更したい場合はこれを編集してください。



# データ構造とクラスの説明

## JavaScriptのファイル構成について
- tableControl.js 処理の中心です。
- nnnUtil.js ユーティリティクラスを定義しています。
- tableData.js 表データと表オプションを定義します。

## 主なクラスとその構成について
- ViewControl  
　起動時にコールされ、全体の画面制御を実行します。  
　表データ、表オプション（サンプルではtableDataSource、tableColumnOptionArray）を受け取ります。  
　以下に示す各エリアの制御クラスを持ち、適切にそれらを実行します。  
　制御クラスは主に、エリア内の表示と画面操作イベントを定義します。  
- MenuAreaControl  
　メニューエリア制御クラス  
- ConfigAreaControl  
　設定エリア制御クラス  
- DisplayChangeAreaControl  
　表示変更エリア制御クラス  
- PagingAreaControl  
　ページングエリア制御クラス  
- TableControl  
　表エリアの制御クラス  
　起動時にViewControlからコールされ、表データ、表オプションを解析します。  
　解析したデータは以下の表データクラスTableDataに保持します。  
  - 文字列 tableCode 表コード  
  - 文字列 tableName 表名  
  - 配列 TableColumn tableColumnArray;  
    - ID id ID、tableDataSourceより生成  
    - ID eventDisplayId 表示判定するためのイベント識別ID、tableDataSourceより生成  
    - 数値 index カラムインデックス、tableDataSourceより取得  
    - 文字列 name カラム名、tableDataSourceより取得  
    - 文字列 type カラム型、tableDataSourceより取得  
    - 文字列 dateFormat カラム型(日付)、tableDataSourceより取得  
    - 文字列 option カラムオプション、tableDataSourceより取得  
  - マップ TableRecord tableRecordMap  
    - ID id tableDataSourceより生成  
    - ID eventDisplayId tableDataSourceより生成  
    - 配列 valueArray  
    - 配列 displayArray  
  - errorElementArray  

上記に示す各エリア制御クラスは以下の属性を持ちます。

  - TableState tableState 表の表示/非表示に使用する要素
  - 画面操作のイベントが発生し、各エリアで変化しうる状態を本クラスに集約・保持します。
  - 制御クラス間の状態の受け渡しは本クラスを介します。  
    （●はconfigの値を反映する）
    - recordCheckSet        ●レコードの表示/非表示選択状態 表「recordDisplaySet」チェック時に変更
    - recordSearchSet       検索結果によるレコードの表示/非表示状態 設定「検索」時に変更
    - recordPageSet         ページングによるレコードの表示/非表示状態 ページ変更時に変更
    - columnSortArray       各カラムのソート状態 設定「ソート初期化」時とソート時と表再表示時に変更
    - page                  現在のページ数 ページ変更時と表再表示時に変更
    - totalPage             ●総ページ数 設定「pageRecordCount」入力時に変更
  - TableConfig tableConfig;
    設定クラス。保持すべきデータを定義します。
    設定の変更の都度、ローカルストレージに保存するメソッド
    起動時にローカルストレージより設定を読み込むメソッドを持ちます。
    - parseErrorDisplay     表データの書式エラーを表示
    - pageRecordCount       1ページの表示数（レコード）
    - omitLength            長文を省略する文字数
    - columnDisplayFlg      チェックしたカラムを表示
    - recordDisplayFlg      チェックしたレコードを表示
    - columnIndexDisplaySet カラムの表示/非表示選択を保持するセット
    - recordDisplaySet      レコードの表示/非表示選択を保持するセット


# Lisence

This project is licensed under the MIT License, see the LICENSE.txt file for details
